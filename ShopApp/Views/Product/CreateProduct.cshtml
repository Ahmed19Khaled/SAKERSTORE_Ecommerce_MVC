@model ShopApp.ViewModel.AddProductViewModel

@{
    Layout = "_AdminLayout";
    var isEdit = Model?.Id != 0;
    ViewData["Title"] = isEdit ? "Edit Product" : "Create Product";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .neumorphic {
        background: #f0f0f0;
        box-shadow: 20px 20px 60px #bebebe, -20px -20px 60px #ffffff;
        border: none;
    }

    .gradient-header {
        background: var(--primary-gradient);
        color: white;
    }

    .floating-input {
        border: 2px solid #e2e8f0;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: white;
    }

        .floating-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

    .preview-image {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
    }

        .preview-image:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

    .color-picker {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

        .color-picker:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

    .stock-card {
        background: white;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
    }

        .stock-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

    .upload-zone {
        border: 3px dashed #cbd5e0;
        background: #f8fafc;
        transition: all 0.3s ease;
    }

        .upload-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
            transform: scale(1.02);
        }

    .btn-gradient {
        background: var(--primary-gradient);
        color: white;
        border: none;
        transition: all 0.3s ease;
    }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

    .badge-pulse {
        animation: pulse 2s infinite;
    }

    @@keyframes pulse {
        0%

    {
        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
    }

    70% {
        box-shadow: 0 0 0 10px rgba(102, 126, 234, 0);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
    }

    }

    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @@keyframes fadeIn {
        from

    {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    .slide-in {
        animation: slideIn 0.3s ease-out;
    }

    @@keyframes slideIn {
        from

    {
        transform: translateX(-100%);
        opacity: 0;
    }

    to {
        transform: translateX(0);
        opacity: 1;
    }

    }

    .price-input-group .input-group-text {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
    }

    .tab-content {
        background: white;
        border-radius: 0 0 15px 15px;
        padding: 2rem;
    }

    .nav-tabs .nav-link {
        border: none;
        color: #64748b;
        font-weight: 600;
        padding: 1rem 1.5rem;
        transition: all 0.3s;
    }

        .nav-tabs .nav-link.active {
            background: var(--primary-gradient);
            color: white;
            border-radius: 10px 10px 0 0;
            transform: translateY(-2px);
        }

    .stats-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s;
    }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .stats-card i {
            font-size: 2.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
</style>

<div class="container-fluid py-4">
    <form asp-action="@(isEdit ? "EditProduct" : "CreateProduct")" method="post" enctype="multipart/form-data" id="productForm">
        <div asp-validation-summary="ModelOnly" class="alert alert-danger alert-dismissible fade show shadow-lg border-0" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>Please fix the following errors:</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

        <!-- Header Section -->
        <div class="glass-card rounded-4 p-4 mb-5">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="d-flex align-items-center">
                        <div class="p-3 rounded-3 bg-gradient-primary me-3">
                            <i class="bi @(isEdit ? "bi-pencil-square" : "bi-plus-circle-dotted") text-white fs-1"></i>
                        </div>
                        <div>
                            <h1 class="fw-bold mb-1 display-6" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                                @ViewData["Title"]
                            </h1>
                            <p class="text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                @(isEdit ? "Update product details and inventory" : "Add new product to your store catalog")
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="d-flex gap-2 justify-content-end">
                        <a asp-action="listProduct" class="btn btn-outline-secondary px-4 rounded-pill">
                            <i class="bi bi-arrow-left me-2"></i>Back to List
                        </a>
                        <button type="submit" class="btn-gradient px-4 rounded-pill">
                            <i class="bi @(isEdit ? "bi-check2-circle" : "bi-plus-circle") me-2"></i>
                            @(isEdit ? "Update Product" : "Create Product")
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats (Edit Mode Only) -->
        @if (isEdit)
        {
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="stats-card">
                        <i class="bi bi-box-seam"></i>
                        <h3 class="mt-2 fw-bold">@(Model.Stocks?.Sum(s => s.QuantityAvaiable) ?? 0)</h3>
                        <p class="text-muted mb-0">Total Stock</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <i class="bi bi-palette"></i>
                        <h3 class="mt-2 fw-bold">@(Model.Stocks?.Select(s => s.Color).Distinct().Count() ?? 0)</h3>
                        <p class="text-muted mb-0">Color Variants</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <i class="bi bi-rulers"></i>
                        <h3 class="mt-2 fw-bold">@(Model.Stocks?.Select(s => s.Size).Distinct().Count() ?? 0)</h3>
                        <p class="text-muted mb-0">Size Variants</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <i class="bi bi-image"></i>
                        <h3 class="mt-2 fw-bold">@(Model.ExistingImages?.Count ?? 0)</h3>
                        <p class="text-muted mb-0">Gallery Images</p>
                    </div>
                </div>
            </div>
        }

        <div class="row g-4">
            <!-- Left Column -->
            <div class="col-lg-8">
                <!-- Tabs Navigation -->
                <ul class="nav nav-tabs" id="productTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">
                            <i class="bi bi-info-circle me-2"></i>Basic Info
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="inventory-tab" data-bs-toggle="tab" data-bs-target="#inventory" type="button" role="tab">
                            <i class="bi bi-boxes me-2"></i>Inventory
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="pricing-tab" data-bs-toggle="tab" data-bs-target="#pricing" type="button" role="tab">
                            <i class="bi bi-tag me-2"></i>Pricing
                        </button>
                    </li>
                </ul>

                <!-- Tabs Content -->
                <div class="tab-content" id="productTabsContent">
                    <!-- Basic Info Tab -->
                    <div class="tab-pane fade show active" id="basic" role="tabpanel">
                        @if (isEdit)
                        {
                            <input name="id" value="@Model.Id" type="hidden" />
                        }

                        <div class="row g-3">
                            <div class="col-md-8">
                                <div class="form-floating mb-4">
                                    <input asp-for="Name" class="form-control floating-input rounded-3" placeholder="Enter product name" />
                                    <label asp-for="Name" class="fw-medium">
                                        <i class="bi bi-box me-2"></i>Product Name
                                    </label>
                                    <div class="form-text">Enter a descriptive name for your product</div>
                                    <span asp-validation-for="Name" class="text-danger small mt-1 d-block"></span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating p-4">
                                    <select asp-for="SubCategoryId" class="form-select p-3  floating-input rounded-3" id="departmentSelect">
                                        <option value="">Select Department</option>
                                        @if (ViewBag.Departments != null)
                                        {
                                            foreach (var dept in ViewBag.Departments)
                                            {
                                                <option value="@dept.Id">@dept.Name</option>
                                            }
                                        }
                                    </select>
                                    <label asp-for="SubCategoryId" class="fw-medium">
                                        <i class="bi bi-diagram-3 me-2"></i>Department
                                    </label>
                                    <span asp-validation-for="SubCategoryId" class="text-danger small mt-1 d-block"></span>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Description" class="form-label fw-medium mb-3">
                                <i class="bi bi-text-paragraph me-2"></i>Product Description
                            </label>
                            <textarea asp-for="Description" class="form-control floating-input rounded-3" rows="6"
                                      placeholder="Describe your product in detail..."></textarea>
                            <div class="form-text">Include features, specifications, and benefits</div>
                            <span asp-validation-for="Description" class="text-danger small mt-1 d-block"></span>
                        </div>
                    </div>

                    <!-- Inventory Tab -->
                    <div class="tab-pane fade" id="inventory" role="tabpanel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="fw-bold mb-0">Stock Variants</h5>
                            <button type="button" class="btn-gradient rounded-pill px-4" onclick="addStock()">
                                <i class="bi bi-plus-circle me-2"></i>Add Variant
                            </button>
                        </div>

                        <div id="stockContainer" class="row g-3">
                            @if (Model.Stocks != null && Model.Stocks.Count > 0)
                            {
                                for (int i = 0; i < Model.Stocks.Count; i++)
                                {
                                    <div class="col-md-6 stock-card slide-in">
                                        <div class="card border-0 shadow-sm h-100">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start mb-3">
                                                    <h6 class="fw-bold mb-0">Variant #@(i + 1)</h6>
                                                    <button type="button" class="btn btn-sm btn-outline-danger rounded-circle"
                                                            onclick="removeStock(this)" title="Remove variant">
                                                        <i class="bi bi-x-lg"></i>
                                                    </button>
                                                </div>

                                                <input type="hidden" name="Stocks[@i].StockId" value="@Model.Stocks[i].StockId" />

                                                <div class="row g-3">
                                                    <div class="col-12">
                                                        <label class="form-label small text-muted">Color</label>
                                                        <div class="d-flex align-items-center gap-3">
                                                            <input asp-for="Stocks[@i].Color" type="color"
                                                                   class="color-picker" title="Choose color" />
                                                            <input asp-for="Stocks[@i].Color"
                                                                   class="form-control form-control-sm"
                                                                   placeholder="Color name (optional)" />
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label small text-muted">Size</label>
                                                        <input asp-for="Stocks[@i].Size"
                                                               class="form-control floating-input"
                                                               placeholder="e.g., XL, 42, M" />
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label class="form-label small text-muted">Quantity</label>
                                                        <input asp-for="Stocks[@i].QuantityAvaiable"
                                                               class="form-control floating-input"
                                                               type="number" min="0" placeholder="0" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="col-12">
                                    <div class="text-center py-5 border-2 border-dashed rounded-3 bg-light">
                                        <i class="bi bi-box-seam display-1 text-muted mb-3"></i>
                                        <h5 class="text-muted mb-2">No Stock Variants Added</h5>
                                        <p class="text-muted mb-4">Add your first variant to start managing inventory</p>
                                        <button type="button" class="btn-gradient rounded-pill px-4" onclick="addStock()">
                                            <i class="bi bi-plus-circle me-2"></i>Add First Variant
                                        </button>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Pricing Tab -->
                    <div class="tab-pane fade" id="pricing" role="tabpanel">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body">
                                        <h6 class="fw-bold mb-4">
                                            <i class="bi bi-currency-dollar me-2"></i>Regular Pricing
                                        </h6>
                                        <div class="input-group mb-3">
                                            <span class="input-group-text bg-success text-white">$</span>
                                            <input asp-for="Price" class="form-control floating-input"
                                                   placeholder="0.00" />
                                            <span class="input-group-text">USD</span>
                                        </div>
                                        <span asp-validation-for="Price" class="text-danger small"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-0 shadow-sm h-100">
                                    <div class="card-body">
                                        <h6 class="fw-bold mb-4">
                                            <i class="bi bi-percent me-2"></i>Special Offer
                                        </h6>
                                        <div class="input-group mb-3">
                                            <span class="input-group-text bg-warning text-dark">$</span>
                                            <input asp-for="Offer" class="form-control floating-input"
                                                   placeholder="0.00" />
                                            <span class="input-group-text">USD</span>
                                        </div>
                                        <span asp-validation-for="Offer" class="text-danger small"></span>
                                        <div class="form-text text-muted small">
                                            Leave empty if no special offer
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-4">
                <!-- Media Upload Card -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header gradient-header border-0 py-3">
                        <h5 class="card-title mb-0 text-white fw-bold">
                            <i class="bi bi-camera me-2"></i>Product Gallery
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Upload Zone -->
                        <div class="upload-zone rounded-3 p-4 text-center mb-4" id="uploadZone">
                            <i class="bi bi-cloud-arrow-up-fill fs-1 mb-3" style="background: var(--secondary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
                            <h5 class="fw-bold mb-2">Drag & Drop Images</h5>
                            <p class="text-muted small mb-3">or click to browse files</p>
                            <input type="file" name="formFile" class="d-none" id="fileInput"
                                   accept="image/*" multiple onchange="previewMultipleImages(event)" />
                            <button type="button" class="btn btn-outline-primary rounded-pill px-4"
                                    onclick="document.getElementById('fileInput').click()">
                                <i class="bi bi-folder2-open me-2"></i>Browse Files
                            </button>
                            <div class="mt-2 text-muted small">
                                <i class="bi bi-info-circle me-1"></i>
                                Supports: JPG, PNG, JPEG • Max 5MB each
                            </div>
                        </div>

                        <!-- Gallery Preview -->
                        <h6 class="fw-bold mb-3 d-flex align-items-center">
                            <i class="bi bi-images me-2"></i>Gallery Preview
                            <span class="badge bg-primary badge-pulse ms-2" id="imageCount">
                                @(Model.ExistingImages?.Count ?? 0) images
                            </span>
                        </h6>

                        <div id="previewContainer" class="row g-2">
                            @if (Model.ExistingImages != null)
                            {
                                foreach (var image in Model.ExistingImages)
                                {
                                    <div class="col-6 col-md-4 position-relative fade-in">
                                        <div class="position-relative overflow-hidden rounded-3 preview-image">
                                            <img src="~/ImgePro/@image.ImageURL"
                                                 class="img-fluid w-100"
                                                 style="height: 120px; object-fit: cover;" />
                                            <div class="position-absolute top-0 end-0 p-1">
                                                <button type="submit"
                                                        asp-action="DeleteImageByid"
                                                        asp-controller="Product"
                                                        asp-route-imageId="@image.ImageId"
                                                        class="btn btn-danger btn-sm rounded-circle shadow-sm"
                                                        onclick="return confirm('Are you sure you want to delete this image?');">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                </div>

                <!-- Status & Actions Card -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0 py-3">
                        <h5 class="card-title mb-0 fw-bold text-dark">
                            <i class="bi bi-lightning-charge me-2"></i>Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn-gradient rounded-3 py-3">
                                <i class="bi @(isEdit ? "bi-check2-circle" : "bi-plus-circle") me-2"></i>
                                @(isEdit ? "Update Product" : "Publish Product")
                            </button>
                            <a asp-action="listProduct" class="btn btn-outline-secondary rounded-3 py-3">
                                <i class="bi bi-arrow-left me-2"></i>Cancel & Return
                            </a>
                        </div>
                        <div class="mt-4 pt-3 border-top">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="featuredSwitch">
                                <label class="form-check-label fw-medium" for="featuredSwitch">
                                    <i class="bi bi-star-fill text-warning me-2"></i>Mark as Featured
                                </label>
                            </div>
                            <div class="form-check form-switch mt-2">
                                <input class="form-check-input" type="checkbox" id="activeSwitch" checked>
                                <label class="form-check-label fw-medium" for="activeSwitch">
                                    <i class="bi bi-power text-success me-2"></i>Product Active
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        // Initialize Select2
        $(document).ready(function() {
            $('#departmentSelect').select2({
                placeholder: "Select a department",
                allowClear: true,
                width: '100%'
            });

            // Upload zone drag and drop
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');

            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                fileInput.files = e.dataTransfer.files;
                previewMultipleImages({ target: fileInput });
            });

            // Update image count
            updateImageCount();
        });

        // Image preview logic
        function previewMultipleImages(event) {
            const files = event.target.files;
            const container = document.getElementById('previewContainer');

            // Remove existing new previews to avoid duplicates
            const oldPreviews = container.querySelectorAll('.new-preview');
            oldPreviews.forEach(el => el.remove());

            for (let i = 0; i < files.length; i++) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const div = document.createElement("div");
                    div.className = "col-6 col-md-4 position-relative fade-in new-preview";
                    div.innerHTML = `
                        <div class="position-relative overflow-hidden rounded-3 preview-image">
                            <img src="${e.target.result}"
                                 class="img-fluid w-100"
                                 style="height: 120px; object-fit: cover;" />
                            <span class="position-absolute top-0 start-0 badge bg-primary m-2 shadow-sm">
                                <i class="bi bi-star-fill me-1"></i>New
                            </span>
                            <button type="button" class="btn btn-danger btn-sm rounded-circle shadow-sm position-absolute top-0 end-0 m-2"
                                    onclick="removePreview(this)">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(div);
                };
                reader.readAsDataURL(files[i]);
            }

            updateImageCount();
        }

        function removePreview(button) {
            const preview = button.closest('.new-preview');
            preview.classList.add('fade-out');
            setTimeout(() => {
                preview.remove();
                updateImageCount();
            }, 300);
        }

        function updateImageCount() {
            const existingCount = @(Model.ExistingImages?.Count ?? 0);
            const newCount = document.querySelectorAll('.new-preview').length;
            const total = existingCount + newCount;

            const countBadge = document.getElementById('imageCount');
            countBadge.textContent = `${total} image${total !== 1 ? 's' : ''}`;

            if (newCount > 0) {
                countBadge.classList.add('bg-success');
                countBadge.classList.remove('bg-primary');
            } else {
                countBadge.classList.add('bg-primary');
                countBadge.classList.remove('bg-success');
            }
        }

        // Stock management logic
        let stockIndex = @(Model.Stocks?.Count ?? 0);

        function addStock() {
            const container = document.getElementById('stockContainer');

            // Remove empty state if present
            const emptyState = container.querySelector('.col-12.text-center');
            if (emptyState) {
                emptyState.remove();
            }

            const colDiv = document.createElement('div');
            colDiv.className = 'col-md-6 stock-card';
            colDiv.style.animation = 'slideIn 0.3s ease-out';

            colDiv.innerHTML = `
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h6 class="fw-bold mb-0">New Variant</h6>
                            <button type="button" class="btn btn-sm btn-outline-danger rounded-circle"
                                    onclick="removeStock(this)" title="Remove variant">
                                <i class="bi bi-x-lg"></i>
                            </button>
                        </div>

                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label small text-muted">Color</label>
                                <div class="d-flex align-items-center gap-3">
                                    <input type="color" name="Stocks[${stockIndex}].Color"
                                           class="color-picker" value="#667eea" title="Choose color" />
                                    <input name="Stocks[${stockIndex}].Color"
                                           class="form-control form-control-sm"
                                           placeholder="Color name (optional)" />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small text-muted">Size</label>
                                <input name="Stocks[${stockIndex}].Size"
                                       class="form-control floating-input"
                                       placeholder="e.g., XL, 42, M" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small text-muted">Quantity</label>
                                <input name="Stocks[${stockIndex}].QuantityAvaiable"
                                       class="form-control floating-input"
                                       type="number" min="0" placeholder="0" />
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.appendChild(colDiv);
            stockIndex++;
        }

        function removeStock(button) {
            const stockCard = button.closest('.stock-card');
            stockCard.style.animation = 'fadeOut 0.3s ease-out';

            setTimeout(() => {
                stockCard.remove();

                // Show empty state if no variants remain
                const container = document.getElementById('stockContainer');
                if (container.children.length === 0) {
                    container.innerHTML = `
                        <div class="col-12">
                            <div class="text-center py-5 border-2 border-dashed rounded-3 bg-light">
                                <i class="bi bi-box-seam display-1 text-muted mb-3"></i>
                                <h5 class="text-muted mb-2">No Stock Variants Added</h5>
                                <p class="text-muted mb-4">Add your first variant to start managing inventory</p>
                                <button type="button" class="btn-gradient rounded-pill px-4" onclick="addStock()">
                                    <i class="bi bi-plus-circle me-2"></i>Add First Variant
                                </button>
                            </div>
                        </div>
                    `;
                }
            }, 300);
        }

        // Form validation and enhancement
        document.getElementById('productForm').addEventListener('submit', function(e) {
            const price = parseFloat(document.querySelector('[name="Price"]').value);
            const offer = parseFloat(document.querySelector('[name="Offer"]').value);

            if (offer && offer >= price) {
                e.preventDefault();
                alert('Offer price must be less than regular price');
                return false;
            }

            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="bi bi-arrow-clockwise spin me-2"></i>Processing...';
            submitBtn.disabled = true;
        });

        // Add CSS for spinner
        const style = document.createElement('style');
        style.textContent = `
            .spin { animation: spin 1s linear infinite; }
            @@keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .fade-out {
                animation: fadeOut 0.3s ease-out forwards;
            }
            @@keyframes fadeOut {
                from { opacity: 1; transform: scale(1); }
                to { opacity: 0; transform: scale(0.8); }
            }
        `;
        document.head.appendChild(style);
    </script>
}