@model List<ShopApp.Models.Order>

@{
    ViewData["Title"] = "My Orders";
    Layout = "_AdminLayout";
}

<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --info-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .stats-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(0,0,0,0.05);
    }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .stats-card i {
            font-size: 2.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

    .order-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid #e2e8f0;
        position: relative;
    }

        .order-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }

        .order-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary-gradient);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .order-card:hover::before {
            opacity: 1;
        }

    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }

    .status-pending {
        background: linear-gradient(135deg, #f6e05e, #ed8936);
        color: white;
    }

    .status-processing {
        background: linear-gradient(135deg, #4299e1, #3182ce);
        color: white;
    }

    .status-shipped {
        background: linear-gradient(135deg, #68d391, #38a169);
        color: white;
    }

    .status-delivered {
        background: linear-gradient(135deg, #4fd1c5, #319795);
        color: white;
    }

    .status-cancelled {
        background: linear-gradient(135deg, #fc8181, #e53e3e);
        color: white;
    }

    .filter-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

    .search-input {
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        padding: 0.75rem 1rem;
        transition: all 0.3s;
        background: #f8fafc;
    }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: white;
        }

    .btn-gradient {
        background: var(--primary-gradient);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s;
    }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

    .empty-state {
        background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        border-radius: 20px;
        padding: 4rem 2rem;
        text-align: center;
        border: 2px dashed #cbd5e0;
    }

        .empty-state i {
            font-size: 4rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

    .timeline {
        position: relative;
        padding-left: 30px;
    }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

    .timeline-item {
        position: relative;
        margin-bottom: 1.5rem;
    }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

    .animated-gradient {
        background: linear-gradient(-45deg, #667eea, #764ba2, #4facfe, #00f2fe);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
    }

    @@keyframes gradient {
        0%

    {
        background-position: 0% 50%;
    }

    50% {
        background-position: 100% 50%;
    }

    100% {
        background-position: 0% 50%;
    }

    }

    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @@keyframes fadeIn {
        from

    {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }

    }

    .pulse {
        animation: pulse 2s infinite;
    }

    @@keyframes pulse {
        0%

    {
        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
    }

    70% {
        box-shadow: 0 0 0 10px rgba(102, 126, 234, 0);
    }

    100% {
        box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
    }

    }

    .chart-container {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

    .order-progress {
        height: 8px;
        border-radius: 4px;
        background: #e2e8f0;
        overflow: hidden;
    }

    .order-progress-bar {
        height: 100%;
        border-radius: 4px;
        background: var(--primary-gradient);
        transition: width 1s ease-in-out;
    }

    .hover-lift {
        transition: transform 0.3s;
    }

        .hover-lift:hover {
            transform: translateY(-3px);
        }
</style>

<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="display-6 fw-bold mb-2" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="bi bi-bag-check-fill me-3"></i>Order Management
                    </h1>
                    <p class="text-muted mb-0">
                        <i class="bi bi-info-circle me-1"></i>
                        Manage and track all customer orders efficiently
                    </p>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <button class="btn btn-outline-primary rounded-pill px-4">
                        <i class="bi bi-download me-2"></i>Export Report
                    </button>
                    <button class="btn-gradient rounded-pill px-4">
                        <i class="bi bi-plus-circle me-2"></i>New Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Overview -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stats-card fade-in" style="animation-delay: 0.1s">
                <i class="bi bi-cart-check"></i>
                <h3 class="mt-3 fw-bold">@Model.Count</h3>
                <p class="text-muted mb-0">Total Orders</p>
                <div class="mt-2">
                    <span class="text-success small">
                        <i class="bi bi-arrow-up"></i> 12% from last month
                    </span>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stats-card fade-in" style="animation-delay: 0.2s">
                <i class="bi bi-currency-dollar"></i>
                <h3 class="mt-3 fw-bold">
                    @Model.Sum(o => o.TotalAmount).ToString("C")
                </h3>
                <p class="text-muted mb-0">Total Revenue</p>
                <div class="mt-2">
                    <span class="text-success small">
                        <i class="bi bi-arrow-up"></i> 18% growth
                    </span>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stats-card fade-in" style="animation-delay: 0.3s">
                <i class="bi bi-clock-history"></i>
                <h3 class="mt-3 fw-bold">
                    @Model.Count(o => o.Status == "Pending")
                </h3>
                <p class="text-muted mb-0">Pending Orders</p>
                <div class="order-progress mt-3">
                    <div class="order-progress-bar"
                         style="width: @((Model.Count > 0 ? (Model.Count(o => o.Status == "Pending") / (double)Model.Count) * 100 : 0))%"></div>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="stats-card fade-in" style="animation-delay: 0.4s">
                <i class="bi bi-truck"></i>
                <h3 class="mt-3 fw-bold">
                    @Model.Count(o => o.Status == "Delivered")
                </h3>
                <p class="text-muted mb-0">Delivered</p>
                <div class="order-progress mt-3">
                    <div class="order-progress-bar"
                         style="width: @((Model.Count > 0 ? (Model.Count(o => o.Status == "Delivered") / (double)Model.Count) * 100 : 0))%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filter-card p-4 mb-4">
        <form asp-action="GetAllOrder" method="get" id="filterForm">
            <div class="row g-3">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="form-label fw-medium mb-2">
                            <i class="bi bi-funnel me-2"></i>Status Filter
                        </label>
                        <select name="status" class="form-select search-input" onchange="document.getElementById('filterForm').submit()">
                            <option value="">All Statuses</option>
                            <option value="Pending">🟡 Pending</option>
                            <option value="Processing">🔵 Processing</option>
                            <option value="Shipped">🟢 Shipped</option>
                            <option value="Delivered">✅ Delivered</option>
                            <option value="Cancelled">🔴 Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="form-label fw-medium mb-2">
                            <i class="bi bi-calendar me-2"></i>Date Range
                        </label>
                        <input type="date" class="form-control search-input" placeholder="From Date" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="form-label fw-medium mb-2">
                            <i class="bi bi-calendar me-2"></i>To Date
                        </label>
                        <input type="date" class="form-control search-input" placeholder="To Date" />
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="form-label fw-medium mb-2">
                            <i class="bi bi-search me-2"></i>Search Orders
                        </label>
                        <div class="input-group">
                            <input type="text" class="form-control search-input" placeholder="Order ID, Customer Name..." />
                            <button type="submit" class="btn-gradient">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-primary rounded-pill px-4" onclick="resetFilters()">
                            <i class="bi bi-arrow-clockwise me-2"></i>Reset Filters
                        </button>
                        <button type="submit" class="btn-gradient rounded-pill px-4">
                            <i class="bi bi-filter me-2"></i>Apply Filters
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Orders Grid -->
    @if (Model != null && Model.Any())
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            @foreach (var order in Model)
            {
                <div class="col fade-in">
                    <div class="order-card h-100">
                        <!-- Order Header -->
                        <div class="p-4 border-bottom" style="background: linear-gradient(135deg, #f8fafc, #f1f5f9);">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="bg-primary rounded-circle p-2 me-3">
                                        <i class="bi bi-receipt text-white"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-bold mb-0">ORDER #@order.Id</h6>
                                        <small class="text-muted">@order.OrderDate.ToString("dd MMM yyyy - hh:mm tt")</small>
                                    </div>
                                </div>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-light rounded-circle" type="button" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item" asp-action="Details" asp-route-orderId="@order.Id">
                                                <i class="bi bi-eye me-2"></i>View Details
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="#">
                                                <i class="bi bi-printer me-2"></i>Print Invoice
                                            </a>
                                        </li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li>
                                            <form asp-action="Delete" asp-route-id="@order.Id" method="post"
                                                  onsubmit="return confirmDelete(event, @order.Id)">
                                                <button type="submit" class="dropdown-item text-danger">
                                                    <i class="bi bi-trash3 me-2"></i>Delete Order
                                                </button>
                                            </form>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Payment ID with copy button -->
                            <div class="d-flex justify-content-between align-items-center bg-white p-3 rounded-3">
                                <div>
                                    <small class="text-muted d-block">Payment ID</small>
                                    <code class="fw-bold">#@order.PaymobeOrderId</code>
                                </div>
                                <button class="btn btn-sm btn-outline-secondary" onclick="copyToClipboard('@order.PaymobeOrderId')">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Customer Info -->
                        <div class="p-4">
                            <div class="row mb-3">
                                <div class="col-12 mb-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-person-circle text-primary me-2"></i>
                                        <strong>Customer</strong>
                                    </div>
                                    <h6 class="fw-bold mb-1">@order.FullName</h6>
                                    <div class="d-flex align-items-center gap-3">
                                        <span class="text-muted">
                                            <i class="bi bi-telephone me-1"></i>@order.PhoneNumber
                                        </span>
                                    </div>
                                </div>

                                <div class="col-12 mb-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-geo-alt text-warning me-2"></i>
                                        <strong>Delivery Address</strong>
                                    </div>
                                    <p class="mb-0 text-muted">@order.Address, @order.City</p>
                                </div>

                                <div class="col-12">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-cash-stack text-success me-2"></i>
                                        <strong>Payment Details</strong>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>Total Amount</span>
                                        <h5 class="mb-0 fw-bold" style="color: #10b981;">
                                            @order.TotalAmount.ToString("C")
                                        </h5>
                                    </div>
                                </div>
                            </div>

                            <!-- Status Badge -->
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="fw-medium">Order Status</span>
                                    <div class="timeline-item" style="position: relative; left: auto; top: auto;">
                                        <small class="text-muted">Last updated: 2 hours ago</small>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="status-badge status-@order.Status.ToLower()">
                                        <i class="bi @GetStatusIcon(order.Status) me-2"></i>@order.Status
                                    </span>
                                    @if (order.Status == "Pending")
                                    {
                                        <span class="pulse badge bg-warning">Action Required</span>
                                    }
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-flex gap-2">
                                <a asp-action="Details" asp-route-orderId="@order.Id"
                                   class="btn btn-outline-primary flex-fill hover-lift">
                                    <i class="bi bi-eye me-2"></i>View Details
                                </a>
                                @if (order.Status == "Pending")
                                {
                                    <button class="btn btn-success flex-fill hover-lift">
                                        <i class="bi bi-check-circle me-2"></i>Process
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Pagination -->
        <div class="row mt-5">
            <div class="col-12">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    }
    else
    {
        <!-- Empty State -->
        <div class="empty-state fade-in">
            <i class="bi bi-cart-x"></i>
            <h3 class="fw-bold mb-3" style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                No Orders Found
            </h3>
            <p class="text-muted mb-4">You haven't received any orders yet. Start by adding products to your store.</p>
            <div class="d-flex justify-content-center gap-3">
                <button class="btn-gradient rounded-pill px-4 py-2">
                    <i class="bi bi-plus-circle me-2"></i>Add Products
                </button>
                <button class="btn btn-outline-primary rounded-pill px-4 py-2">
                    <i class="bi bi-arrow-clockwise me-2"></i>Refresh
                </button>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        // Helper function to get status icon
        function getStatusIcon(status) {
            const icons = {
                'Pending': 'bi-clock',
                'Processing': 'bi-gear',
                'Shipped': 'bi-truck',
                'Delivered': 'bi-check-circle',
                'Cancelled': 'bi-x-circle'
            };
            return icons[status] || 'bi-question-circle';
        }

        // Copy to clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show success toast
                showToast('Payment ID copied to clipboard!', 'success');
            });
        }

        // Enhanced delete confirmation
        function confirmDelete(event, orderId) {
            event.preventDefault();

            Swal.fire({
                title: 'Are you sure?',
                text: "Order #" + orderId + " will be permanently deleted!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel',
                backdrop: 'rgba(0,0,0,0.4)'
            }).then((result) => {
                if (result.isConfirmed) {
                    event.target.closest('form').submit();
                }
            });

            return false;
        }

        // Reset filters
        function resetFilters() {
            document.querySelectorAll('.search-input').forEach(input => {
                if(input.tagName === 'SELECT') {
                    input.selectedIndex = 0;
                } else {
                    input.value = '';
                }
            });
            document.getElementById('filterForm').submit();
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;

            document.body.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();

            toast.addEventListener('hidden.bs.toast', function () {
                toast.remove();
            });
        }

        // Order status timeline animation
        document.addEventListener('DOMContentLoaded', function() {
            const timelineItems = document.querySelectorAll('.timeline-item');
            timelineItems.forEach((item, index) => {
                item.style.animationDelay = `${index * 0.1}s`;
            });

            // Update stats with animation
            const progressBars = document.querySelectorAll('.order-progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0';
                setTimeout(() => {
                    bar.style.width = width;
                }, 500);
            });

            // Add hover effects to cards
            const cards = document.querySelectorAll('.order-card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    card.style.zIndex = '100';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.zIndex = '1';
                });
            });
        });
    </script>
}

@functions {
    private string GetStatusIcon(string status)
    {
        return status switch
        {
            "Pending" => "bi-clock",
            "Processing" => "bi-gear",
            "Shipped" => "bi-truck",
            "Delivered" => "bi-check-circle",
            "Cancelled" => "bi-x-circle",
            _ => "bi-question-circle"
        };
    }
}